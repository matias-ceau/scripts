# cmus Album Picker (dmenu, Xonsh)

---

**albumplayer.xsh**: Select an album via dmenu and queue it in cmus, plus random extras

---

### Dependencies

- `xonsh` — script interpreter (shebang).
- `cmus`/`cmus-remote` — music player and remote control CLI.
- `dmenu` — fuzzy menu for album selection.
- `~/.config/cmus/lib.pl` — cmus library file (generated by cmus).
- `Arch/qtile` (optional) — for keybinding integration via lazy.spawn.

### Description

This Xonsh script reads your cmus library, builds an album list from your music directory structure, lets you pick an album via dmenu, and then queues that album followed by 10 random other albums. It writes the resulting playlist to `/tmp/temp.m3u` and instructs cmus to clear the queue and start playing.

How albums are detected:
- It assumes tracks are stored as …/Artist/Album/Track.ext, and derives albums from the last two directory components (Artist/Album).
- Entries are shown in dmenu with right-aligned artist (trimmed to 50 chars), an en dash, and the album name.

Playback flow:
- Clears current queue, loads the generated M3U, starts playback, and skips to next track.

### Usage

- Ensure cmus is running and your library is populated: start `cmus`, add music, build the library (`:update-cache`).
- Run the script from a terminal: `~/.scripts/bin/albumplayer.xsh`
- Select an album from dmenu; it will enqueue that album plus 10 random albums.
- Make it executable if needed: `chmod +x ~/.scripts/bin/albumplayer.xsh`
- Optional PATH convenience: add `export PATH="$HOME/.scripts/bin:$PATH"` to your shell config.
- qtile binding example: in your config, use `lazy.spawn("~/.scripts/bin/albumplayer.xsh")`.

---

> [!WARNING]
> - The path to `lib.pl` is relative (`.config/cmus/lib.pl`), so running the script outside $HOME will fail; use `~/.config/cmus/lib.pl` or `os.path.expanduser` for robustness.
> - If dmenu is cancelled, the script will crash (empty selection leads to index error). Add a guard when no selection is made.
> - Album matching relies on substring checks and may misidentify when multiple entries share similar labels; consider mapping via stable keys instead of string contains.
> - The command sequence ends with `cmus-remote -n`, which skips the first queued track; remove if unintended.
> - `dmenu -l 300` may exceed screen height; a smaller list size or `-g` (if using dmenu patches) could be friendlier.